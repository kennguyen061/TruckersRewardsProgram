image: node:latest # the docker image to pull

cache: #cache node_modules between builds to make it run faster
  paths:
    - node_modules/

stages: #setting the stages of CI. If one stage fails the others will not run
  - test
  - build
  - publish

test:
  stage: test
  script:
    - npm set progress=false
    - npm install
    - npm run test

build:
  stage: build
  script:
    - npm set progress=false
    - npm install
    - npm run build
  artifacts:
    expire_in: 1 day
    paths:
    - dist
    - lib
    - src

publish:
  stage: publish
  allow_failure: true
  script:
    - npm set //registry.npmjs.org/:_authToken=$NPM_TOKEN
    - npm publish

